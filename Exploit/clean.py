import json
from openai import OpenAI

api_key = ""
client = OpenAI(api_key=api_key, base_url="https://api.deepseek.com/v1")
def read(fp):
    try:
        messages = []
        with open(fp, 'r', encoding='utf-8') as f:
            data = json.load(f)
            for item in data:
                if 'content' in item and item['content'].strip():
                    messages.append({"role": "user", "content": item['content']})
        return messages
    except FileNotFoundError:
        print(f"Error: File '{fp}' not found.")
        return []
    except json.JSONDecodeError:
        print(f"Error: Failed to decode JSON from file '{fp}'. It may not be valid JSON.")
        return []

def call_api(ms):
    try:
        # Make the API call
        response = client.chat.completions.create(
            model="deepseek-coder",
            messages=[ms]
        )
        response_dict = {
            'choices': [{'index': choice.index, 'content': choice.message.content} for choice in response.choices],
        }
        print(json.dumps(response_dict, indent=4))

    except Exception as e:
        print(f"An error occurred: {e}")

file_path = "../Exploit/data/51974-51970.json"
messages = read(file_path)

if messages:
    for message in messages:
        print("Processing message:", message)
        call_api(message)
else:
    print("No messages to process.")


