import json
import os

def transfer_data(old_files_dir, new_file_path, include_split=True):
    # Initialize a list to hold all new data
    combined_data_list = []

    # Loop through each file in the directory containing old files
    for filename in os.listdir(old_files_dir):
        old_file_path = os.path.join(old_files_dir, filename)

        # Read the old JSON file
        with open(old_file_path, 'r') as file:
            old_data = json.load(file)

        if isinstance(old_data, list):
            # Create a new data structure for each entry
            for entry in old_data:
                new_data = {
                    "instruction": entry["problem"],
                    "output": entry["answer"][0]["content"]
                }
                # Optionally add the split key based on function parameter
                if include_split:
                    new_data["split"] = "train"

                combined_data_list.append(new_data)

    # Write the new JSON file with all combined entries
    with open(new_file_path, 'w') as file:
        json.dump(combined_data_list, file, indent=4)


# Example usage:
transfer_data('data', 'ExploitDB/output/59-40.json', include_split=False)